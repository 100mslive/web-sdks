## useDevices

This hook can be used to implement a UI component which allows the user to manually change their
audio/video device. It returns the list of all devices as well as the currently selected one. The input
devices will be returned based on what the user is allowed to publish, so a audio only user won't get
the audioInput field. This can be used to show the UI dropdowns properly.

Note:
- Browsers give access to the list of devices only if the user has given permission to access them
- Changing devices manually work best in combination with remembering the user's selection for the next time, do
  pass the rememberDeviceSelection flag at time of join for this to happen.

import { Story, Preview } from '@storybook/addon-docs';

### Interface

```jsx
interface useDevicesInput {
/**
 * to handle any error during toggle of audio/video
 */
 handleError?: (err: Error, method?: string) => void;
}
```

````jsx
interface useDevicesResult {
  /**
   * list of all devices by type
   */
  allDevices: DeviceTypeAndInfo<MediaDeviceInfo[]>;
  /**
   * selected device ids for all types
   */
  selectedDeviceIDs: DeviceTypeAndInfo<string>;
  /**
   * function to call to update device
   */
  updateDevice: ({ deviceType, deviceId }: { deviceType: DeviceType; deviceId: string }) => Promise<void>;
}
````

### Example

<Story id="hooks-usedevices--use-devices" />

```jsx
const Devices = () => {
  const { allDevices, selectedDeviceIDs, updateDevice } = useDevices();

  return (
    <Flex>
      <DeviceSelector
        title="Speaker"
        icon={<SpeakerIcon />}
        devices={allDevices.audioOutput}
        selection={selectedDeviceIDs.audioOutput}
        onChange={deviceId =>
          updateDevice({
            deviceId,
            deviceType: DeviceType.audioOutput,
          })
        }
        children={null}
      />
    </Flex>
  );
};

const DialogDropdownTrigger = ({ title, css, open, icon, titleCSS = {} }) => {
  return (
    <Dropdown.Trigger
      asChild
      data-testid={`${title}_selector`}
      css={{
        border: '1px solid $borderLight',
        bg: '$surfaceLight',
        r: '$1',
        p: '$6 $9',
        zIndex: 10,
        ...css,
      }}
    >
      <Flex
        css={{
          display: 'flex',
          justifyContent: 'space-between',
          color: '$textHighEmp',
          w: '100%',
        }}
      >
        {icon}
        <Text
          css={{
            color: 'inherit',
            flex: '1 1 0',
            mx: '$6',
            ...titleCSS,
          }}
        >
          {title}
        </Text>
        {open ? <ChevronUpIcon /> : <ChevronDownIcon />}
      </Flex>
    </Dropdown.Trigger>
  );
};

const DeviceSelector = ({ title, devices, selection, onChange, icon, children = null }) => {
  const [open, setOpen] = useState(false);
  const selectionBg = '$bgSecondary';

  return (
    <Box css={{ mb: '$10' }}>
      <Text css={{ mb: '$4' }}>{title}</Text>
      <Flex
        align="center"
        css={{
          gap: '$4',
          '@md': {
            flexDirection: children ? 'column' : 'row',
            alignItems: children ? 'start' : 'center',
          },
        }}
      >
        <Box
          css={{
            position: 'relative',
            flex: '1 1 0',
            w: '100%',
            minWidth: 0,
            '@md': {
              mb: children ? '$8' : 0,
            },
          }}
        >
          <Dropdown.Root open={open} onOpenChange={setOpen}>
            <DialogDropdownTrigger
              css={{
                ...(children
                  ? {
                      flex: '1 1 0',
                      minWidth: 0,
                    }
                  : {}),
              }}
              icon={icon}
              title={devices.find(({ deviceId }) => deviceId === selection)?.label || 'Select device from list'}
              open={open}
            />
            <Dropdown.Portal>
              <Dropdown.Content align="start" sideOffset={8} css={{ w: '200px', zIndex: 1000 }}>
                {devices.map(device => {
                  return (
                    <Dropdown.Item
                      key={device.label}
                      onSelect={() => onChange(device.deviceId)}
                      css={{
                        px: '$9',
                        bg: device.deviceId === selection ? selectionBg : undefined,
                      }}
                    >
                      <Text>{device.label}</Text>
                    </Dropdown.Item>
                  );
                })}
              </Dropdown.Content>
            </Dropdown.Portal>
          </Dropdown.Root>
        </Box>
        {children}
      </Flex>
    </Box>
  );
};
```
